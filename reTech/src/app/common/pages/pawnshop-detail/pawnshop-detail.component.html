<div class="container-fluid mt-3">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="profile-header d-flex align-items-start p-3 mb-3" *ngIf="pawnShop$| async as profile; else notLoggedIn">
                <!-- Pawnshop Logo -->
                <div class="avatar-img me-4">
                    <img [src]="profile?.logoUrl || 'assets/png/default-pawnshop.jpg'"
                        alt="pawnshop-logo"
                        class="rounded-circle me-3"
                        width="190"
                        height="190" />
                    
                </div>

                <!-- Pawnshop Info -->
                <div class="flex-grow-1 ms-5 profile-info" *ngIf="profile">

                    <div class="info-block">
                        <div class="d-flex align-items-center flex-wrap gap-5">
                        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                        <h3 class="mb-0 me-3">{{ profile?.name || 'Pawnshop name' }}</h3>

                        <!-- üïí –í—Ä–µ–º—è -->
                        <p class="text-muted mb-0 small fw-semibold d-flex align-items-center">
                            <i class="fa-regular fa-clock me-1"></i>
                            {{ profile?.openTime }} ‚Äì {{ profile?.closeTime }}
                            <span
                            [ngClass]="{
                                'text-success': isOpenNow,
                                'text-danger': !isOpenNow
                            }"
                            class="ms-2 fw-bold"
                            >
                            {{ isOpenNow ? '–û—Ç–∫—Ä—ã—Ç–æ' : '–ó–∞–∫—Ä—ã—Ç–æ' }}
                            </span>
                        </p>

                        <!-- ‚è∞ –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è -->
                        <p class="text-muted mb-0 small fw-semibold d-flex align-items-center">
                            <i class="fa-regular fa-clock me-1"></i>
                            {{ currentTime | date:'shortTime' }}
                        </p>

                        <!-- ‚≠ê –†–µ–π—Ç–∏–Ω–≥ -->
                        <div class="d-flex align-items-center">
                            <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                            <i
                                class="fa-star"
                                [ngClass]="{
                                'fa-solid text-warning': profile.rating >= star,
                                'fa-regular text-muted': profile.rating < star
                                }"
                                style="font-size: 16px; margin-right: 3px;"
                            ></i>
                            </ng-container>
                            <i 
                                class="fa-solid fa-heart ms-3"
                                
                                style="font-size: 20px; cursor: pointer;"
                                ></i>
                        </div>
                        
                        </div>
                        <hr class="my-4 divider-custom" />
                    </div>

                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    <div class="description-block">
                        <div class="d-flex align-items-center justify-content-between mb-2">

                            <!-- –û –ù–ê–° -->
                            <h6 class="fw-semibold mb-0 d-flex align-items-center">
                                <i class="fa-regular fa-file-lines me-2 text-primary"></i>
                                –û –Ω–∞—Å
                            </h6>

                            <!-- –£–°–õ–û–í–ò–Ø –°–î–ï–õ–ö–ò (–≤ —Ä—è–¥!) -->
                            <div class="terms-block" *ngIf="profile?.terms">
                                <span 
                                    class="text-primary fw-semibold d-flex align-items-center terms-toggle"
                                    (click)="openTermsModal()"
                                    style="cursor:pointer;"
                                >
                                    –£—Å–ª–æ–≤–∏—è —Å–¥–µ–ª–∫–∏
                    
                                </span>
                            </div>

                        </div>

                        <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –±–ª–æ–∫ —É—Å–ª–æ–≤–∏–π -->
                        <div class="mt-3 p-3 border rounded bg-light" *ngIf="showTerms">
                            <h6 class="fw-semibold mb-3 d-flex align-items-center">
                                <i class="fa-solid fa-scale-balanced me-2 text-primary"></i>
                                –£—Å–ª–æ–≤–∏—è –ª–æ–º–±–∞—Ä–¥–∞
                            </h6>

                            <ul class="list-unstyled mb-0">
                                <li *ngIf="profile.terms.interestRate">
                                    <strong>–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞:</strong> {{ profile.terms.interestRate }}%
                                </li>

                                <li *ngIf="profile.terms.minTermDays">
                                    <strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫:</strong> {{ profile.terms.minTermDays }} –¥–Ω–µ–π
                                </li>

                                <li *ngIf="profile.terms.maxAmount">
                                    <strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞:</strong> {{ profile.terms.maxAmount | number:'1.0-0' }} ‚Ç∏
                                </li>

                                <li *ngIf="profile.terms.fees">
                                    <strong>–ö–æ–º–∏—Å—Å–∏—è:</strong> {{ profile.terms.fees }} ‚Ç∏
                                </li>

                                <li *ngIf="profile.terms.additional">
                                    <strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</strong> {{ profile.terms.additional }}
                                </li>
                            </ul>
                        </div>

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <p class="text-muted mb-0">
                            {{ profile?.description || '–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' }}
                        </p>
                    </div>

                </div>
                <!-- –£–°–õ–û–í–ò–Ø –õ–û–ú–ë–ê–†–î–ê -->


            </div>

            <ng-template #notLoggedIn>
                <div class="alert alert-warning d-flex align-items-center p-4 mb-3" role="alert">
                <i class="fa-solid fa-profile-lock me-3 fs-4"></i>
                <div>
                    <h5 class="mb-1 fw-bold">{{ 'You are not logged in' | translate }}</h5>
                    <p class="mb-0">
                    {{ 'Please' | translate }}
                    <a routerLink="/login" class="text-primary fw-semibold">{{ 'log in' | translate }}</a>
                    {{ 'or' | translate }}
                    <a routerLink="/register" class="text-primary fw-semibold">{{ 'register' | translate }}</a>.
                    </p>
                </div>
                </div>
            </ng-template>

            
        </div>

        <div class="row align-items-stretch mt-4">
  <!-- –§–û–¢–û –õ–û–ú–ë–ê–†–î–ê -->
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="image-gallery" *ngIf="pawnShop$ | async as profile; else notLoggedIn">
                <h5 class="fw-semibold mb-3">
                    <i class="fa-regular fa-images me-2 text-primary"></i>
                    –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª–æ–º–±–∞—Ä–¥–∞
                </h5>

                <div class="gallery-grid">
                    <div *ngFor="let photo of profile.photos" class="gallery-item">
                    <img [src]="photo" alt="–§–æ—Ç–æ –ª–æ–º–±–∞—Ä–¥–∞" />
                    </div>
                </div>
                </div>
            </div>

        <!-- –¢–û–í–ê–†–´ –õ–û–ú–ë–ê–†–î–ê -->
            <div class="col-lg-8 col-md-6 mb-4">
                <div class="pawnshop-products" *ngIf="products$ | async as products">
                    <h5 class="fw-semibold mb-3">
                        <i class="fa-solid fa-box-open me-2 text-primary"></i>
                        –¢–æ–≤–∞—Ä—ã –ª–æ–º–±–∞—Ä–¥–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ
                    </h5>

                <div *ngIf="products.length > 0; else noProducts" class="product-container">
                    <div class="mb-3" *ngFor="let product of products">
                        <div class="product-card" (click)="openProductDetail(product)" style="position: relative;">
                            <img [src]="product.photos[0]" alt="main-photo" class="main-photo">

                                <i 
                                class="fa-solid fa-heart" 
                                style="position: absolute; top: 10px; right: 10px; font-size: 1.2rem; cursor: pointer;"
                                [ngClass]="{
                                    'text-danger': user?.favoriteItems?.includes(product._id),
                                    'text-white': !user?.favoriteItems?.includes(product._id)
                                }"
                                (click)="toggleFavoriteItem(product._id, $event)">
                                </i>

                            <div class="info-block">
                                <span class="product-title">{{ product.title }}</span>
                                <span class="product-price">{{ product.price | number }} ‚Ç∏</span>
                                <span class="product-date">{{ product.createdAt | date: 'd MMMM' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <ng-template #noProducts>
                    <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ</p>
                </ng-template>
                </div>

                <!-- –ë–ª–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ -->
            </div>
            <div class="pawnshop-reviews mt-4" *ngIf="pawnShop$ | async as profile">
                <h5 class="fw-semibold mb-3">
                    <i class="fa-regular fa-comment-dots me-2 text-primary"></i>
                    –û—Ç–∑—ã–≤—ã
                    <span class="text-muted small">({{ profile.reviews?.length || 0 }})</span>
                </h5>
    
            <!-- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ -->
            <div class="mb-3">
                <ng-container *ngFor="let star of [1,2,3,4,5]">
                <i
                    class="fa-star"
                    [ngClass]="{
                    'fa-solid text-warning': (profile.rating || 0) >= star,
                    'fa-regular text-muted': (profile.rating || 0) < star
                    }"
                ></i>
                </ng-container>
                <span class="ms-2">{{ profile.rating?.toFixed(1) || 0 }}/5</span>
            </div>
    
            <!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3 –æ—Ç–∑—ã–≤–æ–≤ -->
            <div *ngIf="profile.reviews?.length > 0; else noReviews">
                <div *ngFor="let review of profile.reviews | slice:-3" class="review-item mb-2 border-bottom pb-2">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-semibold">{{ review.userName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' }}</span>
                    <small class="text-muted">{{ review.createdAt | date:'dd MMM yyyy' }}</small>
                </div>
                <div class="mb-1">
                    <ng-container *ngFor="let star of [1,2,3,4,5]">
                    <i
                        class="fa-star"
                        style="font-size: 10px;"
                        [ngClass]="{
                        'fa-solid text-warning': review.rating >= star,
                        'fa-regular text-muted': review.rating < star
                        }"
                    ></i>
                    </ng-container>
                </div>
                <p class="mb-0 text-muted">{{ review.comment }}</p>
                </div>
            </div>
    
            <ng-template #noReviews>
                <p class="text-muted mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>
            </ng-template>
    
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ -->
                <div class="mt-3">
                    <h6>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h6>
                    <div class="d-flex align-items-center mb-2">
                        <ng-container *ngFor="let star of [1,2,3,4,5]">
                            <i
                            class="fa-star me-1"
                            [ngClass]="{'fa-solid text-warning': star <= newRating, 'fa-regular text-muted': star > newRating}"
                            style="cursor:pointer; font-size: 20px;"
                            (click)="newRating = star"
                            ></i>
                        </ng-container>
                    </div>
                        <textarea [(ngModel)]="newComment" class="form-control mb-2" rows="2" placeholder="–í–∞—à –æ—Ç–∑—ã–≤..."></textarea>
                    <button class="btn btn-primary btn-sm" (click)="addReview(profile._id)">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>



    </div>
</div>